<!DOCTYPE html>
<html>
<head>
  <title>Helmet Info</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <h2>This helmet belongs to Jester Destreza Manuba on FB</h2>
  <p>If found, please contact the owner at 0970 863 1067.</p>
  <p id="status">Attempting to log location...</p>

  <script>
    // âœ… Using your deployed Google Script URL
    const scriptURL = "https://script.google.com/macros/s/AKfycby3dHWDsmUfvoJjWD6Ix2A9EVu9_NF0nLJbSWeOwXTRDBil5iR1GsLDdkE6iGJ1xbn7rA/exec";

    function sendLocation(lat, lon, ip="N/A", err="OK") {
      fetch(`${scriptURL}?lat=${lat}&lon=${lon}&ip=${ip}&err=${encodeURIComponent(err)}`)
        .then(() => {
          document.getElementById("status").innerText = "Thank you! Location recorded.";
        })
        .catch(error => {
          document.getElementById("status").innerText = "Error sending data.";
          console.error("Send error:", error);
        });
    }

    function logIPOnly(errorMsg="No GPS") {
      fetch("https://api.ipify.org?format=json")
        .then(r => r.json())
        .then(data => {
          sendLocation("N/A", "N/A", data.ip, errorMsg);
          document.getElementById("status").innerText = "Logged IP only (" + errorMsg + ")";
        })
        .catch(err => {
          console.error("IP fetch error:", err);
          document.getElementById("status").innerText = "Could not get location or IP.";
        });
    }

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        function(pos) {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          console.log("Got GPS:", lat, lon);
          sendLocation(lat, lon);
        },
        function(err) {
          console.warn("Geolocation error:", err.message);
          document.getElementById("status").innerText = 
            "GPS unavailable (" + err.message + "). Using IP instead.";
          logIPOnly(err.message);
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 0
        }
      );
    } else {
      document.getElementById("status").innerText = "Geolocation not supported.";
      logIPOnly("Geolocation not supported");
    }
  </script>
</body>
</html>
